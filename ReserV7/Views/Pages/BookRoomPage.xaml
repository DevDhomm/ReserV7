<Page
  x:Class="ReserV7.Views.Pages.BookRoomPage"
  x:Name="RootPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:ReserV7.Views.Pages"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
  Title="Réserver une Salle"
  d:DataContext="{d:DesignInstance local:BookRoomPage, IsDesignTimeCreatable=False}"
  d:DesignHeight="450"
  d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
  ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  mc:Ignorable="d"
>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- Header -->
    <StackPanel Grid.Row="0" Margin="20" Orientation="Vertical">
      <TextBlock FontSize="28" FontWeight="Bold" Text="Rooms" Margin="0,0,0,4" />
      <TextBlock FontSize="20" FontWeight="Bold" Text="Salles" Margin="0,0,0,4" />
      <TextBlock FontSize="14"  Text="Trouvez et reservez la salle que vous recherchez" />
    </StackPanel>

    <!-- Filters Section -->
    <Border Grid.Row="1" Background="{DynamicResource ControlFillColorDefaultBrush}" Margin="20,0,20,20" Padding="16" CornerRadius="8">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="250" />
          <ColumnDefinition Width="150" />
          <ColumnDefinition Width="150" />
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Search by name -->
        <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,12,0">
          <TextBlock Text="Recherche par nom" FontSize="12" FontWeight="Bold" Margin="0,0,0,4" />
          <TextBox Text="{Binding ViewModel.SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
        </StackPanel>

        <!-- Min Capacity -->
        <StackPanel Grid.Column="1" Grid.Row="0" Margin="0,0,12,0">
          <TextBlock Text="Capacite minimale" FontSize="12" FontWeight="Bold" Margin="0,0,0,4" />
          <TextBox Text="{Binding ViewModel.MinCapacity, Mode=TwoWay}" />
        </StackPanel>

        <!-- Floor -->
        <StackPanel Grid.Column="2" Grid.Row="0" Margin="0,0,12,0">
          <TextBlock Text="Étage" FontSize="12" FontWeight="Bold" Margin="0,0,0,4" />
          <ComboBox SelectedIndex="{Binding ViewModel.SelectedFloor, Mode=TwoWay}">
            <ComboBoxItem>Tous</ComboBoxItem>
            <ComboBoxItem>1</ComboBoxItem>
            <ComboBoxItem>2</ComboBoxItem>
            <ComboBoxItem>3</ComboBoxItem>
          </ComboBox>
        </StackPanel>

        <!-- Equipment Filters -->
        <StackPanel Grid.Column="3" Grid.Row="0" Margin="0,0,12,0">
          <TextBlock Text="Filtre par équipement" FontSize="12" FontWeight="Bold" Margin="0,0,0,4" />
          <ScrollViewer Height="32" VerticalScrollBarVisibility="Hidden" HorizontalScrollBarVisibility="Auto">
            <StackPanel Orientation="Horizontal">
              <ItemsControl ItemsSource="{Binding ViewModel.EquipementFilters}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <StackPanel Orientation="Horizontal" />
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <CheckBox Content="{Binding Nom}" IsChecked="{Binding IsSelected, Mode=TwoWay}" Margin="0,0,12,0" VerticalAlignment="Center" />
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </ScrollViewer>
        </StackPanel>

        <!-- Apply Filter Button -->
        <Button Grid.Column="4" Grid.Row="0" Command="{Binding ViewModel.ApplyFiltersCommand}" Cursor="Hand" Background="CadetBlue" Content="Appliquer les filtres" VerticalAlignment="Bottom" Margin="0,0,8,0" />

        <!-- Reset Button -->
        <Button Grid.Column="5" Grid.Row="0" Command="{Binding ViewModel.ResetFiltersCommand}" Content="Reset" Cursor="Hand" Background="IndianRed" VerticalAlignment="Bottom" />

        <!-- Selection info -->
        <TextBlock Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="6" Margin="0,8,0,0" FontSize="11"  Text="{Binding ViewModel.Salles.Count, StringFormat='Sélection: {0} salle(s) trouvée(s)'}" />
      </Grid>
    </Border>

    <!-- Rooms Grid -->
    <ScrollViewer Grid.Row="2"  Margin="20,0,20,20">
      <ItemsControl ItemsSource="{Binding ViewModel.Salles, Mode=OneWay}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center" />
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
                        <Border Background="{DynamicResource ControlFillColorDefaultBrush}" BorderBrush="CadetBlue" BorderThickness="1.5" CornerRadius="8" Margin="0,0,16,16" Width="360" Padding="0">
                            <Border.Effect>
                                <DropShadowEffect Color="Black" BlurRadius="12" ShadowDepth="2" Opacity="0.2" Direction="270" />
                            </Border.Effect>
                            <Grid>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto" />
                  <RowDefinition Height="*" />
                  <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Card Header -->
                <StackPanel Grid.Row="0" Margin="16,16,16,12">
                  <TextBlock FontSize="18" FontWeight="Bold" Text="{Binding Nom}" Margin="0,0,0,8" TextWrapping="Wrap" />
                  <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                    <TextBlock Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="{Binding Capacite, StringFormat='Capacite: {0} pers.'}" Margin="0,0,12,0" />
                    <TextBlock Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="|" Margin="0,0,12,0" />
                    <TextBlock Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="{Binding Etage, StringFormat='Étage {0}'}" />
                  </StackPanel>
                </StackPanel>

                <!-- Card Content - Equipments -->
                <StackPanel Grid.Row="1" Margin="16,0,16,12">
                  <TextBlock FontSize="12" FontWeight="Bold" Text="Équipements:" Margin="0,0,0,6" />
                  <ItemsControl ItemsSource="{Binding Equipements}" MaxHeight="80">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <TextBlock FontSize="11" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Text="{Binding Nom, StringFormat='• {0}'}" Margin="0,2,0,2" />
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>

                <!-- Card Footer Button -->
                <Button Grid.Row="2" Command="{Binding DataContext.ViewModel.SelectRoomForBookingCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}" CommandParameter="{Binding}" Cursor="Hand" Background="CadetBlue" Content="Reserver" Margin="16,0,16,16" Padding="12,8,12,8" />
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>
  </Grid>
</Page>

