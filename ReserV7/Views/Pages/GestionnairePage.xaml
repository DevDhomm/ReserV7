<Page
  x:Class="ReserV7.Views.Pages.GestionnairePage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:ReserV7.Views.Pages"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
  Title="Gestionnaire"
  d:DataContext="{d:DesignInstance local:GestionnairePage,
                                     IsDesignTimeCreatable=False}"
  d:DesignHeight="600"
  d:DesignWidth="1200"
  ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
  ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  mc:Ignorable="d"
>
  <Grid RowDefinitions="Auto,*">
    <!-- Header Section -->
    <StackPanel Grid.Row="0" Margin="20">
      <TextBlock FontSize="28" FontWeight="Bold" Text="Gestion des Utilisateurs" />
      <TextBlock FontSize="14" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Text="CrÃ©ez, modifiez et supprimez les utilisateurs" Margin="0,4,0,0" />

      <!-- Search and Add Button -->
      <Grid ColumnDefinitions="*,Auto,Auto" Margin="0,12,0,0">
        <TextBox 
          Grid.Column="0"
          x:Name="SearchBox"
          Text="{Binding ViewModel.SearchText, Mode=TwoWay}"
          Padding="12,8"
          VerticalAlignment="Center" />
        <ui:Button
          Grid.Column="1"
          Margin="12,0,0,0"
          Appearance="Secondary"
          Command="{Binding ViewModel.SearchCommand}"
          Content="Chercher"
		  Cursor="Hand"
          Icon="{ui:SymbolIcon Search24}" />
        <ui:Button
          Grid.Column="2"
		  		  Cursor="Hand"

          Margin="16,0,0,0"
          Appearance="Primary"
          Command="{Binding ViewModel.AddUtilisateurCommand}"
          Content="Ajouter Utilisateur"
          Icon="{ui:SymbolIcon Add24}" />
      </Grid>
      <TextBlock 
        FontSize="12" 
        Foreground="{DynamicResource TextFillColorTertiaryBrush}"
        Text="ðŸ’¡ Conseil: Vous pouvez chercher par nom, email ou nom d'utilisateur" 
        Margin="0,8,0,0" />
    </StackPanel>

    <!-- Users Table -->
    <DataGrid
      Grid.Row="1"
      AutoGenerateColumns="False"
      Background="{DynamicResource ControlBackgroundBrush}"
      BorderBrush="{DynamicResource ControlBorderBrush}"
      BorderThickness="1"
      CanUserAddRows="False"
      Margin="20,0,20,20"
      ItemsSource="{Binding ViewModel.FilteredUtilisateurs, Mode=OneWay}"
      SelectedItem="{Binding ViewModel.SelectedUtilisateur, Mode=TwoWay}"
      RowHeaderWidth="0">
      <DataGrid.Columns>
        <!-- Nom -->
        <DataGridTextColumn 
          Binding="{Binding Nom}" 
          Header="Nom" 
          MinWidth="120"
          IsReadOnly="True" />

        <!-- Email -->
        <DataGridTextColumn 
          Binding="{Binding Email}" 
          Header="Email" 
          MinWidth="150"
          IsReadOnly="True" />

        <!-- Username -->
        <DataGridTextColumn 
          Binding="{Binding Username}" 
          Header="Nom d'utilisateur" 
          MinWidth="120"
          IsReadOnly="True" />

        <!-- RÃ´le -->
        <DataGridTextColumn 
          Binding="{Binding Role}" 
          Header="RÃ´le" 
          MinWidth="100"
          IsReadOnly="True" />

        <!-- Date CrÃ©ation -->
        <DataGridTextColumn 
          Binding="{Binding DateCreation, StringFormat='dd/MM/yyyy'}" 
          Header="Date CrÃ©ation" 
          MinWidth="120"
          IsReadOnly="True" />

        <!-- Actions -->
        <DataGridTemplateColumn Header="Actions" MinWidth="220">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <StackPanel Orientation="Horizontal">
                <ui:Button
                  Margin="0,0,8,0"
                  Appearance="Secondary"
                  Command="{Binding DataContext.ViewModel.EditUtilisateurCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                  CommandParameter="{Binding}"
                  ToolTip="Ã‰diter cet utilisateur"
                  Icon="{ui:SymbolIcon Edit24}"
                  Content="Ã‰diter"
                  Padding="12,8" />
                <ui:Button
                  Appearance="Secondary"
                  Command="{Binding DataContext.ViewModel.DeleteUtilisateurCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                  CommandParameter="{Binding}"
                  ToolTip="Supprimer cet utilisateur"
                  Icon="{ui:SymbolIcon Delete24}"
                  Content="Supprimer"
                  BorderBrush="IndianRed"
				  BorderThickness="1.5"
                  Padding="12,8" />
              </StackPanel>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
      </DataGrid.Columns>
    </DataGrid>
  </Grid>
</Page>
