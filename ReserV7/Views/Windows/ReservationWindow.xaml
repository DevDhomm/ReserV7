<Window
  x:Class="ReserV7.Views.Windows.ReservationWindow"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
  Title="Nouvelle Reservation"
  Width="680"
  Height="900"
  WindowStartupLocation="CenterOwner"
  ShowInTaskbar="False"
  WindowStyle="SingleBorderWindow"
      ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
  ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
      Foreground="{DynamicResource TextFillColorPrimaryBrush}"
  d:DesignHeight="900"
  d:DesignWidth="680"
  mc:Ignorable="d"
>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!-- Header -->
    <Border Grid.Row="0"  Padding="16,12,16,12" BorderThickness="0,0,0,1">
      <StackPanel Orientation="Vertical">
                <TextBlock FontSize="18"          
 FontWeight="Bold" Text="Nouvelle Reservation" />
        <TextBlock
          Margin="0,4,0,0"
          FontSize="12"
          x:Name="SalleNameBlock"
          Text="Salle selectionnee"
        />
      </StackPanel>
    </Border>

    <!-- Content -->
    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="16,16,16,16">
        <StackPanel Orientation="Vertical">
          <!-- Section 1: Motif -->
          <Border  CornerRadius="8" Padding="16" Margin="0,0,0,20">
            <StackPanel Orientation="Vertical">
                        <TextBlock FontSize="14" FontWeight="Bold"          
 Text="Motif de la reservation *" Margin="0,0,0,8" />
              <TextBox
                x:Name="MotifTextBox"
                Text="{Binding ViewModel.SelectedMotif, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                MinHeight="50"
                TextWrapping="Wrap"
                AcceptsReturn="True"
                Padding="12,10,12,10"
              />
              <TextBlock

                FontSize="11"
                Text="Ex: Cours, Reunion d'equipe, Conference..."
                Margin="0,8,0,0"
              />
            </StackPanel>
          </Border>

          <!-- Section 2: Dates -->
          <Border Background="{DynamicResource ControlFillColorSecondaryBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,20">
            <StackPanel Orientation="Vertical">
                        <TextBlock FontSize="14"           
 FontWeight="Bold" Text="Dates de reservation" Margin="0,0,0,12" />

              <!-- Date debut -->
              <StackPanel Orientation="Vertical" Margin="0,0,0,12">
                            <TextBlock FontSize="12"          
 FontWeight="SemiBold" Text="Date de debut *" Margin="0,0,0,6" />
                <DatePicker
                  x:Name="DateStartPicker"
                  SelectedDate="{Binding ViewModel.SelectedDateStart, Mode=TwoWay}"
                  Padding="12,8,12,8"
                />
              </StackPanel>

              <!-- Date fin -->
              <StackPanel Orientation="Vertical">
                <TextBlock FontSize="12" FontWeight="SemiBold" Text="Date de fin *" Margin="0,0,0,6" />
                <DatePicker
                  x:Name="DateEndPicker"
                  SelectedDate="{Binding ViewModel.SelectedDateEnd, Mode=TwoWay}"
                  Padding="12,8,12,8"
                />
                            <TextBlock FontSize="10"          
 Text="(meme date si 1 jour)" Margin="0,4,0,0" />
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- Section 3: Horaires -->
          <Border Background="{DynamicResource ControlFillColorSecondaryBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,20">
            <StackPanel Orientation="Vertical">
                        <TextBlock FontSize="14"           
 FontWeight="Bold" Text="Horaires" Margin="0,0,0,12" />

              <!-- Mode toggle -->
              <Border
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                CornerRadius="6"
                Padding="12"
                Margin="0,0,0,12"
                BorderBrush="{DynamicResource ControlBorderBrush}"
                BorderThickness="1"
              >
                <StackPanel Orientation="Horizontal">
                  <CheckBox
                    x:Name="UseCustomTimesCheckBox"
                    IsChecked="{Binding ViewModel.UseCustomTimes, Mode=TwoWay}"
                    VerticalAlignment="Center"
                    Margin="0,0,8,0"
                  />
                                <TextBlock VerticalAlignment="Center"          
 Text="Horaires personnalises (au lieu de creneaux)" />
                </StackPanel>
              </Border>

              <!-- Creneaux Selection (if not custom) -->
              <StackPanel x:Name="CreneauxPanel" Orientation="Vertical" Visibility="{Binding ViewModel.UseCustomTimes, Converter={StaticResource BoolToVisibilityConverterInverse}}">
                            <TextBlock          
 FontSize="12" FontWeight="SemiBold" Text="Selectionnez un creneau *" Margin="0,0,0,8" />
                <ListBox
                  x:Name="CreneauxListBox"
                  ItemsSource="{Binding ViewModel.AvailableCreneaux}"
                  SelectedItem="{Binding ViewModel.SelectedCreneau, Mode=TwoWay}"
                  MinHeight="100"
                  MaxHeight="150"
                >
                  <ListBox.ItemTemplate>
                    <DataTemplate>
                      <Border
                        Background="{DynamicResource ControlFillColorDefaultBrush}"
                        CornerRadius="4"
                        Padding="12,8,12,8"
                        Margin="0,2,0,2"
                        BorderBrush="{DynamicResource ControlBorderBrush}"
                        BorderThickness="1"
                      >
                        <Border.Style>
                          <Style TargetType="Border">
                            <Setter Property="Opacity" Value="1" />
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding IsAvailable}" Value="False">
                                <Setter Property="Opacity" Value="0.4" />
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </Border.Style>
                        <Grid>
                          <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                          </Grid.ColumnDefinitions>

                          <TextBlock
                            Grid.Column="0"
                            Text="{Binding DisplayText}"
                            FontWeight="SemiBold"
                            VerticalAlignment="Center"
                          />
                          <TextBlock
                            Grid.Column="1"
                            Margin="8,0,0,0"
                            Text="{Binding IsAvailable, Converter={StaticResource BoolToAvailabilityStringConverter}}"
                            Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                            FontSize="11"
                            VerticalAlignment="Center"
                          />
                        </Grid>
                      </Border>
                    </DataTemplate>
                  </ListBox.ItemTemplate>
                </ListBox>
              </StackPanel>

              <!-- Custom Times (if selected) -->
              <StackPanel
                x:Name="CustomTimesPanel"
                Orientation="Vertical"
                Visibility="{Binding ViewModel.UseCustomTimes, Converter={StaticResource BoolToVisibilityConverter}}"
              >
                <Grid>
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                  </Grid.ColumnDefinitions>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                  </Grid.RowDefinitions>

                  <!-- Heure debut -->
                  <StackPanel Grid.Column="0" Grid.Row="0" Orientation="Vertical" Margin="0,0,8,12">
                    <TextBlock FontSize="12" FontWeight="SemiBold" Text="Heure de debut *" Margin="0,0,0,6" />
                    <TextBox
                      Text="{Binding ViewModel.SelectedTimeStart, Mode=TwoWay}"
                      Padding="12,8,12,8"
                    />
                    <TextBlock FontSize="10" Foreground="{DynamicResource TextFillColorTertiaryBrush}" Text="HH:mm (ex: 09:00)" Margin="0,4,0,0" />
                  </StackPanel>

                  <!-- Heure fin -->
                  <StackPanel Grid.Column="1" Grid.Row="0" Orientation="Vertical" Margin="8,0,0,12">
                    <TextBlock FontSize="12" FontWeight="SemiBold" Text="Heure de fin *" Margin="0,0,0,6" />
                    <TextBox
                      Text="{Binding ViewModel.SelectedTimeEnd, Mode=TwoWay}"
                      Padding="12,8,12,8"
                    />
                    <TextBlock FontSize="10" Foreground="{DynamicResource TextFillColorTertiaryBrush}" Text="HH:mm (ex: 10:00)" Margin="0,4,0,0" />
                  </StackPanel>
                </Grid>
              </StackPanel>
            </StackPanel>
          </Border>

          <!-- Message d'erreur/succes/conflit -->
          <Border
            x:Name="MessageBorder"
            Background="{DynamicResource ControlFillColorDefaultBrush}"
            CornerRadius="8"
            Padding="14"
            Visibility="Collapsed"
            BorderBrush="{DynamicResource ControlBorderBrush}"
            BorderThickness="2"
            Margin="0,0,0,16"
          >
            <StackPanel Orientation="Horizontal">
              <TextBlock
                x:Name="MessageIconBlock"
                FontSize="18"
                Margin="0,0,10,0"
                VerticalAlignment="Center"
                Text="!"
              />
              <TextBlock
                x:Name="MessageTextBlock"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                TextWrapping="Wrap"
                Text="{Binding ViewModel.AvailabilityMessage}"
                VerticalAlignment="Center"
              />
            </StackPanel>
          </Border>
        </StackPanel>
      </ScrollViewer>

      <!-- Footer -->
      <Border
        Grid.Row="2"
        Background="{DynamicResource ControlFillColorSecondaryBrush}"
        Padding="16,12,16,12"
        BorderBrush="{DynamicResource DividerStrokeColorDefaultBrush}"
        BorderThickness="0,1,0,0"
      >
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>

          <!-- Info text -->
          <TextBlock
            Grid.Column="0"
            Foreground="{DynamicResource TextFillColorTertiaryBrush}"
            FontSize="11"
            VerticalAlignment="Center"
            Text="Les champs marques d'un * sont obligatoires"
          />

          <!-- Buttons -->
          <Button
            Grid.Column="1"
            Content="Annuler"
            Width="110"
            Padding="8,6,8,6"
            Click="CancelButton_Click"
            Margin="0,0,12,0"
            Background="IndianRed"
            BorderBrush="{DynamicResource ControlBorderBrush}"
              
            BorderThickness="1"
            Cursor="Hand"
          />
          <Button
            Grid.Column="2"
            Command="{Binding ViewModel.ConfirmBookingCommand}"
            Content="Confirmer"
            Width="110"
            Padding="8,6,8,6"
            Background="CadetBlue"
           
            Cursor="Hand"
          />
        </Grid>
      </Border>
    </Grid>

</Window>
